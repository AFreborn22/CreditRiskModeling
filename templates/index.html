<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Risk Prediction</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap">
    <link rel="stylesheet" href="/static/style/style.css">
</head>
<body>
    <div class="container mt-5">
        <img src="/static/image/LClogo.png" alt="Logo" class="img-fluid mb-4"> 
        <form id="predictionForm" class="needs-validation" novalidate>
            <!-- Form groups for input fields -->
            <div class="form-group">
                <label for="username">Name</label>
                <input type="text" class="form-control" id="username" name="username" required>
                <div class="invalid-feedback">Please enter your name.</div>
            </div>
            <div class="form-group">
                <label for="loan_amnt">Loan Amount</label>
                <input type="number" class="form-control" id="loan_amnt" name="loan_amnt" required>
                <div class="invalid-feedback">Please enter the loan amount.</div>
            </div>
            <div class="form-group">
                <label for="int_rate">Interest Rate</label>
                <input type="number" step="0.01" class="form-control" id="int_rate" name="int_rate" required>
                <div class="invalid-feedback">Please enter the interest rate.</div>
            </div>
            <div class="form-group">
                <label for="home_ownership">Home Ownership</label>
                <select class="form-control" id="home_ownership" name="home_ownership" required>
                    <option value="" disabled selected>Select</option>
                    <option value="RENT">Rent</option>
                    <option value="OWN">Own</option>
                    <option value="MORTGAGE">Mortgage</option>
                    <option value="OTHER">Other</option>
                    <option value="NONE">None</option>
                    <option value="ANY">Any</option>
                </select>
                <div class="invalid-feedback">Please select home ownership.</div>
            </div>
            <div class="form-group">
                <label for="annual_inc">Annual Income</label>
                <input type="number" class="form-control" id="annual_inc" name="annual_inc" required>
                <div class="invalid-feedback">Please enter your annual income.</div>
            </div>
            <div class="form-group">
                <label for="verification_status">Verification Status</label>
                <select class="form-control" id="verification_status" name="verification_status" required>
                    <option value="" disabled selected>Select</option>
                    <option value="Verified">Verified</option>
                    <option value="Source Verified">Source Verified</option>
                    <option value="Not Verified">Not Verified</option>
                </select>
                <div class="invalid-feedback">Please select the verification status.</div>
            </div>
            <div class="form-group">
                <label for="purpose">Purpose</label>
                <select class="form-control" id="purpose" name="purpose" required>
                    <option value="" disabled selected>Select</option>
                    <option value="credit_card">Credit Card</option>
                    <option value="car">Car</option>
                    <option value="small_business">Small Business</option>
                    <option value="other">Other</option>
                    <option value="wedding">Wedding</option>
                    <option value="debt_consolidation">Debt Consolidation</option>
                    <option value="home_improvement">Home Improvement</option>
                    <option value="major_purchase">Major Purchase</option>
                    <option value="medical">Medical</option>
                    <option value="moving">Moving</option>
                    <option value="vacation">Vacation</option>
                    <option value="house">House</option>
                    <option value="renewable_energy">Renewable Energy</option>
                    <option value="educational">Educational</option>
                </select>
                <div class="invalid-feedback">Please select the purpose.</div>
            </div>
            <div class="form-group">
                <label for="addr_state">State</label>
                <select class="form-control" id="addr_state" name="addr_state" required>
                    <option value="" disabled selected>Select</option>
                    <option value="AZ">AZ</option>
                    <option value="GA">GA</option>
                    <option value="IL">IL</option>
                    <option value="CA">CA</option>
                    <option value="OR">OR</option>
                    <option value="NC">NC</option>
                    <option value="TX">TX</option>
                    <option value="VA">VA</option>
                    <option value="MO">MO</option>
                    <option value="CT">CT</option>
                    <option value="UT">UT</option>
                    <option value="FL">FL</option>
                    <option value="NY">NY</option>
                    <option value="PA">PA</option>
                    <option value="MN">MN</option>
                    <option value="NJ">NJ</option>
                    <option value="KY">KY</option>
                    <option value="OH">OH</option>
                    <option value="SC">SC</option>
                    <option value="RI">RI</option>
                    <option value="LA">LA</option>
                    <option value="MA">MA</option>
                    <option value="WA">WA</option>
                    <option value="WI">WI</option>
                    <option value="AL">AL</option>
                    <option value="CO">CO</option>
                    <option value="KS">KS</option>
                    <option value="NV">NV</option>
                    <option value="AK">AK</option>
                    <option value="MD">MD</option>
                    <option value="WV">WV</option>
                    <option value="VT">VT</option>
                    <option value="MI">MI</option>
                    <option value="DC">DC</option>
                    <option value="SD">SD</option>
                    <option value="NH">NH</option>
                    <option value="AR">AR</option>
                    <option value="NM">NM</option>
                    <option value="MT">MT</option>
                    <option value="HI">HI</option>
                    <option value="WY">WY</option>
                    <option value="OK">OK</option>
                    <option value="DE">DE</option>
                    <option value="MS">MS</option>
                    <option value="TN">TN</option>
                    <option value="IA">IA</option>
                    <option value="NE">NE</option>
                    <option value="ID">ID</option>
                    <option value="IN">IN</option>
                    <option value="ME">ME</option>
                </select>
                <div class="invalid-feedback">Please select your state.</div>
            </div>
            <div class="form-group">
                <label for="dti">Debt-to-Income Ratio</label>
                <input type="number" step="0.01" class="form-control" id="dti" name="dti" required>
                <div class="invalid-feedback">Please enter the debt-to-income ratio.</div>
            </div>
            <div class="form-group">
                <label for="delinq_2yrs">Delinquencies in Last 2 Years</label>
                <input type="number" class="form-control" id="delinq_2yrs" name="delinq_2yrs" required>
                <div class="invalid-feedback">Please enter the number of delinquencies in last 2 years.</div>
            </div>
            <div class="form-group">
                <label for="inq_last_6mths">Inquiries in Last 6 Months</label>
                <input type="number" class="form-control" id="inq_last_6mths" name="inq_last_6mths" required>
                <div class="invalid-feedback">Please enter the number of inquiries in last 6 months.</div>
            </div>
            <div class="form-group">
                <label for="mths_since_last_delinq">Months Since Last Delinquency</label>
                <input type="number" class="form-control" id="mths_since_last_delinq" name="mths_since_last_delinq" required>
                <div class="invalid-feedback">Please enter the months since last delinquency.</div>
            </div>
            <div class="form-group">
                <label for="open_acc">Open Accounts</label>
                <input type="number" class="form-control" id="open_acc" name="open_acc" required>
                <div class="invalid-feedback">Please enter the number of open accounts.</div>
            </div>
            <div class="form-group">
                <label for="pub_rec">Public Records</label>
                <input type="number" class="form-control" id="pub_rec" name="pub_rec" required>
                <div class="invalid-feedback">Please enter the number of public records.</div>
            </div>
            <div class="form-group">
                <label for="revol_bal">Revolving Balance</label>
                <input type="number" class="form-control" id="revol_bal" name="revol_bal" required>
                <div class="invalid-feedback">Please enter the revolving balance.</div>
            </div>
            <div class="form-group">
                <label for="revol_util">Revolving Utilization</label>
                <input type="number" step="0.01" class="form-control" id="revol_util" name="revol_util" required>
                <div class="invalid-feedback">Please enter the revolving utilization.</div>
            </div>
            <div class="form-group">
                <label for="total_acc">Total Accounts</label>
                <input type="number" class="form-control" id="total_acc" name="total_acc" required>
                <div class="invalid-feedback">Please enter the total number of accounts.</div>
            </div>
            <div class="form-group">
                <label for="initial_list_status">Initial List Status</label>
                <select class="form-control" id="initial_list_status" name="initial_list_status" required>
                    <option value="" disabled selected>Select</option>
                    <option value="f">f</option>
                    <option value="w">w</option>
                </select>
                <div class="invalid-feedback">Please select the initial list status.</div>
            </div>
            <div class="form-group">
                <label for="out_prncp">Outstanding Principal</label>
                <input type="number" step="0.01" class="form-control" id="out_prncp" name="out_prncp" required>
                <div class="invalid-feedback">Please enter the outstanding principal.</div>
            </div>
            <div class="form-group">
                <label for="total_rec_late_fee">Total Late Fee</label>
                <input type="number" step="0.01" class="form-control" id="total_rec_late_fee" name="total_rec_late_fee" required>
                <div class="invalid-feedback">Please enter the total late fee.</div>
            </div>
            <div class="form-group">
                <label for="recoveries">Recoveries</label>
                <input type="number" step="0.01" class="form-control" id="recoveries" name="recoveries" required>
                <div class="invalid-feedback">Please enter the recoveries amount.</div>
            </div>
            <div class="form-group">
                <label for="collections_12_mths_ex_med">Collections in Last 12 Months Excluding Medical</label>
                <input type="number" class="form-control" id="collections_12_mths_ex_med" name="collections_12_mths_ex_med" required>
                <div class="invalid-feedback">Please enter the number of collections in last 12 months excluding medical.</div>
            </div>
            <div class="form-group">
                <label for="acc_now_delinq">Accounts Now Delinquent</label>
                <input type="number" class="form-control" id="acc_now_delinq" name="acc_now_delinq" required>
                <div class="invalid-feedback">Please enter the number of accounts now delinquent.</div>
            </div>
            <div class="form-group">
                <label for="tot_coll_amt">Total Collection Amount</label>
                <input type="number" step="0.01" class="form-control" id="tot_coll_amt" name="tot_coll_amt" required>
                <div class="invalid-feedback">Please enter the total collection amount.</div>
            </div>
            <div class="form-group">
                <label for="tot_cur_bal">Total Current Balance</label>
                <input type="number" step="0.01" class="form-control" id="tot_cur_bal" name="tot_cur_bal" required>
                <div class="invalid-feedback">Please enter the total current balance.</div>
            </div>
            <div class="form-group">
                <label for="emp_length_int">Employment Length (in years)</label>
                <input type="number" class="form-control" id="emp_length_int" name="emp_length_int" required>
                <div class="invalid-feedback">Please enter the employment length in years.</div>
            </div>
            <div class="form-group">
                <label for="term_int">Loan Term (in months)</label>
                <input type="number" class="form-control" id="term_int" name="term_int" required>
                <div class="invalid-feedback">Please enter the loan term in months.</div>
            </div>
            <div class="form-group">
                <label for="mths_since_earliest_cr_line">Months Since Earliest Credit Line</label>
                <input type="number" class="form-control" id="mths_since_earliest_cr_line" name="mths_since_earliest_cr_line" required>
                <div class="invalid-feedback">Please enter the months since earliest credit line.</div>
            </div>
            <div class="form-group">
                <label for="mths_since_issue_d">Months Since Issue Date</label>
                <input type="number" class="form-control" id="mths_since_issue_d" name="mths_since_issue_d" required>
                <div class="invalid-feedback">Please enter the months since issue date.</div>
            </div>
            <button type="submit" class="btn btn-primary btn-block">Predict</button>
        </form>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByClassName('needs-validation');
                Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();

        document.getElementById("predictionForm").onsubmit = async function(event) {
            event.preventDefault();
            if (this.checkValidity() === false) {
                event.stopPropagation();
                return;
            }
            const formData = new FormData(event.target);
            const data = {};
            formData.forEach((value, key) => {
                if (key !== "username") { // Kecualikan username dari data yang dikirim
                    data[key] = value;
                }
            });
            const response = await fetch("/predict", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            const username = formData.get("username");
            window.location.href = `/result?prediction=${result.prediction}&username=${encodeURIComponent(username)}`;
        };
    </script>
</body>
</html>